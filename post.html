<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>æ–‡ç«  â€” äº‘ç¦»</title>
  <style>
    :root{--bg1:#eaf3ff;--bg2:#f3f8ff;--surface:#f6f9ff;--text:#0b1220;--muted:#6b7280;--accent:#3b82f6;--card-border:rgba(11,18,32,0.06)}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial;margin:0;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:var(--text);transition:background-color .25s,color .25s}
    body.light{--bg1:#f5f7fb;--bg2:#fff;--surface:#fff;--text:#0b1220;--muted:#6b7280;--accent:#2563eb;--card-border:rgba(2,6,23,0.06)}
    .wrap{max-width:900px;margin:28px auto;padding:18px;position:relative}
    .glass-card{margin-top:12px;padding:20px 22px;border-radius:14px;background-color:rgba(255,255,255,0.65);-webkit-backdrop-filter:blur(12px) saturate(160%);backdrop-filter:blur(12px) saturate(160%);border:1px solid rgba(11,18,32,0.06);box-shadow:0 10px 28px rgba(2,6,23,0.18)}
    @media (prefers-reduced-transparency: reduce){.glass-card{-webkit-backdrop-filter:none;backdrop-filter:none;background-color:#ffffff}}
    a{color:var(--accent)}
    footer{padding:28px;text-align:center;color:var(--muted)}
    .theme-toggle{position:fixed;right:14px;top:14px;background:var(--surface);color:var(--text);border:1px solid var(--card-border);padding:8px;border-radius:8px;cursor:pointer}
    .bg{position:fixed;inset:0;background:radial-gradient(1000px 500px at 20% 10%, rgba(96,165,250,.18), transparent 55%),radial-gradient(700px 380px at 80% 30%, rgba(147,197,253,.16), transparent 50%),linear-gradient(180deg,var(--bg1),var(--bg2));z-index:-1}
    /* Responsive images inside article content: limit size, keep aspect ratio, center */
    #content img{
      max-width:100%;
      height:auto;
      max-height:70vh;
      display:block;
      margin:18px auto;
      border-radius:8px;
      box-shadow:0 6px 18px rgba(2,6,23,0.08);
      object-fit:contain;
    }
    @media (max-width:820px){
      #content img{margin:12px auto;}
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
  <div class="bg"></div>
  <div class="wrap">
    <a href="blog.html">â† è¿”å›åšå®¢</a>
    <article id="content" class="glass-card">  åŠ è½½ä¸­â€¦</article>
    <div id="likePanel" class="glass-card" style="margin-top:14px;display:flex;align-items:center;gap:12px;flex-wrap:wrap">
      <button id="likeBtn" style="padding:8px 14px;border-radius:999px;border:1px solid rgba(11,18,32,0.08);background:linear-gradient(180deg,#fff,rgba(255,255,255,0.7));cursor:pointer">ğŸ‘ ç‚¹èµ</button>
      <span id="likeCount" style="color:var(--muted)">likes: 0</span>
      <span id="likeMsg" style="color:var(--muted)"></span>
    </div>
  </div>

  <footer>Â© äº‘ç¦»-post</footer>

  <script>
    function qs(name){const u=new URL(location.href);return u.searchParams.get(name)}
    async function load(){
      let file = qs('file');
      if(!file){document.getElementById('content').innerText='æœªæŒ‡å®šæ–‡ç« æ–‡ä»¶';return}
      try{ file = decodeURIComponent(file); }catch(e){}

      // Allow paths like 'posts/xxx.md' or '/posts/xxx.md'
      if(file.startsWith('/')) file = file.slice(1);
      if(!file.startsWith('posts/')){document.getElementById('content').innerText='æ–‡ç« è·¯å¾„ä¸åˆæ³•ï¼ˆå¿…é¡»åœ¨ posts/ ç›®å½•ä¸‹ï¼‰';console.error('Invalid post path:', file);return}

      try{
        // try multiple relative forms to avoid absolute-path issues
        const candidates = [file, './' + file, '/' + file, location.origin + '/' + file];
        let res = null;
        for(const u of candidates){
          try{ res = await fetch(u); if(res && res.ok) break }catch(err){ console.warn('fetch candidate failed', u, err) }
        }
        if(!res || !res.ok){
          const status = res ? `${res.status} ${res.statusText}` : 'network error';
          const msg = `è¯»å–æ–‡ç« å¤±è´¥ï¼š${status}`;
          document.getElementById('content').innerText = msg;
          console.error('All fetch candidates failed for', file, res);
          return;
        }
        const md = await res.text();
        document.getElementById('content').innerHTML = marked.parse(md);
      }catch(e){
        document.getElementById('content').innerText='è¯»å–æ–‡ç« å¤±è´¥ï¼ˆç½‘ç»œæˆ–è·¨åŸŸé”™è¯¯ï¼‰';
        console.error('Fetch error for', file, e);
      }
    }
    load();
  </script>
  <script>
    const LIKE_API = 'https://homepagelike.12410922.workers.dev/like';
    async function refreshLikes(file){
      if(!file) return;
      const res = await fetch(`${LIKE_API}?id=${encodeURIComponent(file)}`);
      if(res.ok){
        const data = await res.json();
        document.getElementById('likeCount').textContent = `likes: ${data.likes}`;
      }
    }
    async function sendLike(file){
      if(!file) return;
      const btn = document.getElementById('likeBtn');
      const msg = document.getElementById('likeMsg');
      if(btn){btn.disabled = true; btn.textContent = 'å·²ç‚¹èµ';}
      const res = await fetch(`${LIKE_API}?id=${encodeURIComponent(file)}`, {method:'POST'});
      if(res.ok){
        const data = await res.json();
        document.getElementById('likeCount').textContent = `likes: ${data.likes}`;
        if(data.throttled && msg){
          msg.textContent = 'æ“ä½œå¤ªå¿«å•¦';
        } else if(msg){
          msg.textContent = '';
        }
      }
      setTimeout(()=>{ if(btn){btn.disabled = false; btn.textContent = 'ğŸ‘ ç‚¹èµ';} }, 800);
    }
    (function(){
      let file = qs('file');
      if(!file) return;
      try{ file = decodeURIComponent(file); }catch(e){}
      if(file.startsWith('/')) file = file.slice(1);
      const btn = document.getElementById('likeBtn');
      refreshLikes(file);
      if(btn){btn.addEventListener('click', ()=> sendLike(file));}
    })();
  </script>
  <button id="globalThemeBtn" class="theme-toggle" title="åˆ‡æ¢æ—¥/å¤œæ¨¡å¼">ğŸŒ™</button>
  <script>
    const gBtn = document.getElementById('globalThemeBtn');
    function applyThemePage(t){ if(t==='light') document.body.classList.add('light'); else document.body.classList.remove('light'); gBtn.textContent = document.body.classList.contains('light') ? 'â˜€ï¸' : 'ğŸŒ™'; try{localStorage.setItem('site-theme', t)}catch(e){} }
    (function(){ let t='dark'; try{const s=localStorage.getItem('site-theme'); if(s) t=s;}catch(e){} applyThemePage(t); gBtn.addEventListener('click', ()=>{const cur=document.body.classList.contains('light')?'light':'dark'; applyThemePage(cur==='light'?'dark':'light');}); })();
  </script>

<!-- é¼ æ ‡ç‚¹å‡»çˆ±å¿ƒç‰¹æ•ˆ -->
<script>
!function(e,t,a){function r(){for(var e=0;e<s.length;e++)s[e].alpha<=0?(t.body.removeChild(s[e].el),s.splice(e,1)):(s[e].y--,s[e].scale+=.004,s[e].alpha-=.013,s[e].el.style.cssText="left:"+s[e].x+"px;top:"+s[e].y+"px;opacity:"+s[e].alpha+";transform:scale("+s[e].scale+","+s[e].scale+") rotate(45deg);background:"+s[e].color+";z-index:99999");requestAnimationFrame(r)}function n(){var t="function"==typeof e.onclick&&e.onclick;e.onclick=function(e){t&&t(),o(e)}}function o(e){var a=t.createElement("div");a.className="heart",s.push({el:a,x:e.clientX-5,y:e.clientY-5,scale:1,alpha:1,color:c()}),t.body.appendChild(a)}function i(e){var a=t.createElement("style");a.type="text/css";try{a.appendChild(t.createTextNode(e))}catch(t){a.styleSheet.cssText=e}t.getElementsByTagName("head")[0].appendChild(a)}function c(){return"rgb("+~~(255*Math.random())+","+~~(255*Math.random())+","+~~(255*Math.random())+")"}var s=[];e.requestAnimationFrame=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},i(".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}"),n(),r()}(window,document);
</script>
</body>
</html>
