<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Blog</title>
  <meta name="description" content="äº‘ç¦»çš„åšå®¢">
  <style>
    :root{--bg1:#fff6f8;--bg2:#fff0f4;--surface:#fff8fb;--text:#0b1220;--muted:#6b6b6b;--accent:#d9467a;--card-border:rgba(11,18,32,0.06)}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial;margin:0;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:var(--text);transition:background-color .25s,color .25s}
    body.light{--bg1:#f5f7fb;--bg2:#fff;--surface:#fff;--text:#0b1220;--muted:#6b7280;--accent:#2563eb;--card-border:rgba(2,6,23,0.06)}
    .wrap{max-width:900px;margin:36px auto;padding:16px}
    a{color:var(--accent)}
    footer{padding:28px;text-align:center;color:var(--muted)}
    .post{padding:18px;border-radius:12px;margin-bottom:16px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border:1px solid rgba(255,255,255,0.04);}
    .post h3{margin:0 0 6px}
    .controls{display:flex;gap:10px;justify-content:flex-end;align-items:center;margin-bottom:12px;flex-wrap:wrap}
    .search-icon{font-size:16px;line-height:1;filter:drop-shadow(0 2px 6px rgba(214,106,150,0.25))}
    .search-input{background:linear-gradient(180deg,#fff,rgba(255,255,255,0.7));padding:8px 14px;border-radius:999px;color:var(--text);border:1px solid rgba(214,106,150,0.22);box-shadow:0 10px 22px rgba(214,106,150,0.18);transition:transform .18s,box-shadow .18s,border-color .18s;min-width:180px}
    .search-input:focus{outline:none;border-color:#f472b6;animation:jelly 420ms ease}
    .btn{background:linear-gradient(180deg,#fff,rgba(255,255,255,0.7));padding:8px 12px;border-radius:999px;color:var(--text);text-decoration:none;border:1px solid rgba(214,106,150,0.18);box-shadow:0 8px 20px rgba(214,106,150,0.12);transition:transform .18s,box-shadow .18s}
    .btn:hover{transform:translateY(-1px);box-shadow:0 10px 26px rgba(214,106,150,0.18)}
    .controls label{background:linear-gradient(180deg,#fff,rgba(255,255,255,0.7));padding:6px 12px;border-radius:999px;color:var(--muted);border:1px solid rgba(214,106,150,0.18);box-shadow:0 6px 18px rgba(214,106,150,0.10)}
    .filter-select{appearance:none;-webkit-appearance:none;-moz-appearance:none;background:linear-gradient(180deg,#fff,rgba(255,255,255,0.7));padding:8px 36px 8px 14px;border-radius:999px;color:var(--text);border:1px solid rgba(214,106,150,0.22);box-shadow:0 10px 22px rgba(214,106,150,0.18);transition:transform .18s,box-shadow .18s,border-color .18s;cursor:pointer;background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='%23d9467a' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><polyline points='6 9 12 15 18 9'/></svg>");background-repeat:no-repeat;background-position:right 12px center}
    .filter-select:hover{transform:translateY(-1px) scale(1.01);box-shadow:0 12px 26px rgba(214,106,150,0.22)}
    .filter-select:focus{outline:none;border-color:#f472b6;animation:jelly 420ms ease}
    .filter-select:active{transform:scale(0.98)}
    @keyframes jelly{0%{transform:scale(1)}40%{transform:scale(1.04,0.96)}70%{transform:scale(0.98,1.02)}100%{transform:scale(1)}}

    /* Header / nav (copied from index.html) */
    header{display:flex;align-items:center;justify-content:space-between;padding:18px 28px}
    .brand{font-weight:700;font-size:26px}
    .nav-links{display:flex;gap:12px;align-items:center}
    .nav-links a{color:var(--muted);text-decoration:none;padding:8px 10px;border-radius:8px}
    .nav-links a.primary{background:linear-gradient(180deg,var(--accent),#3b82f6);color:#fff}
    .menu-btn{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);padding:8px 10px;border-radius:8px;cursor:pointer;transition:color .18s,border-color .18s,background-color .18s}
    .nav-links a{color:var(--muted);text-decoration:none;padding:8px 10px;border-radius:8px}
    .theme-toggle{position:fixed;right:14px;top:14px;background:var(--surface);color:var(--text);border:1px solid var(--card-border);padding:8px;border-radius:8px;cursor:pointer}
    /* èƒŒæ™¯ä¸ç»ç’ƒå¡ç‰‡æ ·å¼ */
    .bg{position:fixed;inset:0;background-image: url("");background-size:cover;background-position:center;background-repeat:no-repeat;background:radial-gradient(1000px 500px at 20% 10%, rgba(255,192,203,.12), transparent 55%),radial-gradient(700px 380px at 80% 30%, rgba(255,160,180,.08), transparent 50%),linear-gradient(180deg,var(--bg1),var(--bg2));z-index:-1}
    .glass-card{max-width:900px;margin:18px auto;padding:18px;border-radius:12px;background-color:rgba(255,255,255,0.06);-webkit-backdrop-filter:blur(10px) saturate(150%);backdrop-filter:blur(10px) saturate(150%);border:1px solid rgba(255,255,255,0.04);box-shadow:0 8px 20px rgba(2,6,23,0.25);color:var(--text);will-change:backdrop-filter}
    @media (max-width:768px) and (hover:none){.glass-card{-webkit-backdrop-filter:blur(6px) saturate(140%);backdrop-filter:blur(6px) saturate(140%);background-color:rgba(255,255,255,0.08)}}
    @media (prefers-reduced-transparency: reduce){.glass-card{-webkit-backdrop-filter:none;backdrop-filter:none;background-color:rgba(255,255,255,0.92);color:#0b1220}}
    @supports ((-webkit-backdrop-filter: blur(1px)) or (backdrop-filter: blur(1px))){.glass-card{background-color:rgba(255,255,255,0.06);-webkit-backdrop-filter:blur(10px) saturate(150%);backdrop-filter:blur(10px) saturate(150%)}}
    @keyframes popInUp {
      0% {opacity:0; transform:translateY(24px) scale(0.98)}
      60% {opacity:1; transform:translateY(-4px) scale(1.01)}
      100% {opacity:1; transform:translateY(0) scale(1)}
    }
    .preload #list{opacity:0}
    .pop-in{opacity:0;animation:popInUp 1200ms ease-out forwards}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body class="preload">
  <header>
    <a href="index.html" class="brand">äº‘ç¦»</a>
    <nav class="nav-links">
      <a href="blog.html">Blog</a>
      <a href="projects.html">Projects</a>
      <a href="about.html">About</a>
      <button id="themeSwitch" class="menu-btn" aria-label="åˆ‡æ¢ä¸»é¢˜" title="åˆ‡æ¢æ—¥/å¤œæ¨¡å¼">ğŸŒ™</button>
    </nav>
  </header>
  <div class="wrap">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px">
      <h1>Blog</h1>
      <div class="controls">
        <span class="search-icon" aria-hidden="true">ğŸ”</span>
        <input id="searchInput" class="search-input" type="search" placeholder="æœç´¢æ ‡é¢˜/æ ‡ç­¾..." />
        <label for="categorySelect" style="color:var(--muted)">åˆ†ç±»</label>
        <select id="categorySelect" class="filter-select">
          <option value="all">âœ¨ å…¨éƒ¨</option>
          <option value="course">ğŸ“˜ course</option>
          <option value="academic">ğŸ“ academic</option>
          <option value="reflection">ğŸ’­ reflection</option>
          <option value="daily-life">ğŸƒ daily-life</option>
        </select>
        <a class="btn" href="editor.html">å†™æ–‡ç« </a>
      </div>
    </div>

    <div id="list">åŠ è½½ä¸­â€¦</div>
  </div>

  <footer>Â© äº‘ç¦»-blog</footer>
  
  <script>
    async function tryFetch(url){
      try{
        const res = await fetch(url);
        if(!res.ok) throw res;
        return await res.json();
      }catch(e){
        console.error('fetch failed for', url, e);
        throw e;
      }
    }

    const LIKE_API = 'https://homepagelike.12410922.workers.dev/like';

    function normalizeTags(tags){
      if(!tags) return [];
      if(Array.isArray(tags)) return tags.map(t=>String(t).toLowerCase());
      return String(tags).split(/[,\s]+/).map(t=>t.toLowerCase()).filter(Boolean);
    }

    function getCategory(item){
      if(item.category) return String(item.category).toLowerCase();
      const tags = normalizeTags(item.tags);
      const known = ['course','academic','reflection','daily-life'];
      return tags.find(t=>known.includes(t)) || 'uncategorized';
    }

    function matchesQuery(item, query){
      if(!query) return true;
      const q = query.toLowerCase().trim();
      if(!q) return true;
      const words = q.split(/[\s,]+/).filter(Boolean);
      const title = String(item.title || '').toLowerCase();
      const tags = normalizeTags(item.tags).join(' ');
      return words.every(w => title.includes(w) || tags.includes(w));
    }

    async function getLikeCount(file){
      try{
        const res = await fetch(`${LIKE_API}?id=${encodeURIComponent(file)}`);
        if(!res.ok) return 0;
        const data = await res.json();
        return Number(data.likes) || 0;
      }catch(e){
        return 0;
      }
    }

    function renderList(items){
      const list = document.getElementById('list');
      if(!items || items.length===0){
        list.innerHTML = '<p>è¯¥åˆ†ç±»æš‚æ— æ–‡ç« ã€‚</p>';
        return;
      }
      list.innerHTML='';
      items.forEach((entry, i)=>{
        const item = entry.item || entry;
        const likes = typeof entry.likes === 'number' ? entry.likes : 0;
        const el = document.createElement('section'); el.className='glass-card post pop-in';
        // normalize file path: remove leading slash to keep relative path
        let filePath = item.file || '';
        if(filePath.startsWith('/')) filePath = filePath.slice(1);
        el.innerHTML = ` <h3 style="margin:0 0 6px"><a href="post.html?file=${encodeURIComponent(filePath)}">${item.title}</a></h3>
                          <div style="color:var(--muted);margin-top:6px">${item.date} Â· ${item.tags||''}</div>
                          <div style="color:var(--muted);margin-top:6px">ğŸ‘ ${likes}</div>
                          <p style="margin-top:10px">${item.excerpt||''}</p>`;
        el.style.animationDelay = `${140 + i * 180}ms`;
        list.appendChild(el);
      });
    }

    async function loadIndex(){
      const list = document.getElementById('list');
      const candidates = [
        'posts/index.json',
        '/posts/index.json',
        location.origin + '/posts/index.json'
      ];
      let idx = null;
      for(const url of candidates){
        try{ idx = await tryFetch(url); break }catch(e){}
      }
      if(!idx){
        list.innerHTML = '<p>è¯»å–æ–‡ç« ç´¢å¼•å¤±è´¥ã€‚å“¦ä¹°å™¶æ€ä¹ˆè¿˜æœ‰bugâ€¦â€¦è¯·å…ˆæ£€æŸ¥ä½ çš„ç½‘ç»œï¼Œå¦‚æœæ²¡é—®é¢˜å°±å‘ŠçŸ¥å¼€å‘è€…ä¸€å£°ã€‚</p>';
        return;
      }
      if(!Array.isArray(idx) || idx.length===0){list.innerHTML='<p>æš‚æ— æ–‡ç« ã€‚</p>';return}

      const categorySelect = document.getElementById('categorySelect');
      const searchInput = document.getElementById('searchInput');
      async function applyFilter(){
        const value = categorySelect ? categorySelect.value : 'all';
        const query = searchInput ? searchInput.value : '';
        let filtered = value === 'all'
          ? idx
          : idx.filter(item => getCategory(item) === value || normalizeTags(item.tags).includes(value));
        filtered = filtered.filter(item => matchesQuery(item, query));

        const withLikes = await Promise.all(filtered.map(async item => {
          let filePath = item.file || '';
          if(filePath.startsWith('/')) filePath = filePath.slice(1);
          const likes = await getLikeCount(filePath);
          return { item, likes };
        }));

        withLikes.sort((a,b) => b.likes - a.likes);
        renderList(withLikes);
      }
      if(categorySelect){
        categorySelect.addEventListener('change', applyFilter);
      }
      if(searchInput){
        searchInput.addEventListener('input', applyFilter);
      }
      applyFilter();
    }
    loadIndex();
  </script>

  <script>
    // Theme control (persist in localStorage) â€” same asé¦–é¡µ
    const themeSwitch = document.getElementById('themeSwitch');
    function applyTheme(theme){
      if(theme === 'light'){
        document.body.classList.add('light'); themeSwitch.textContent = 'â˜€ï¸';
      } else { document.body.classList.remove('light'); themeSwitch.textContent = 'ğŸŒ™'; }
      try{localStorage.setItem('site-theme', theme)}catch(e){}
    }
    (function(){
      let t = 'dark';
      try{const stored = localStorage.getItem('site-theme'); if(stored) t = stored;}catch(e){}
      applyTheme(t);
      if(themeSwitch){themeSwitch.addEventListener('click', ()=>{const cur = document.body.classList.contains('light') ? 'light' : 'dark'; applyTheme(cur === 'light' ? 'dark' : 'light');});}
    })();
  </script>
  <script>
    // Reveal animation on load
    window.addEventListener('load', () => {
      document.body.classList.add('reveal');
      document.body.classList.remove('preload');
    });
  </script>
<!-- é¼ æ ‡ç‚¹å‡»çˆ±å¿ƒç‰¹æ•ˆ -->
<script>
!function(e,t,a){function r(){for(var e=0;e<s.length;e++)s[e].alpha<=0?(t.body.removeChild(s[e].el),s.splice(e,1)):(s[e].y--,s[e].scale+=.004,s[e].alpha-=.013,s[e].el.style.cssText="left:"+s[e].x+"px;top:"+s[e].y+"px;opacity:"+s[e].alpha+";transform:scale("+s[e].scale+","+s[e].scale+") rotate(45deg);background:"+s[e].color+";z-index:99999");requestAnimationFrame(r)}function n(){var t="function"==typeof e.onclick&&e.onclick;e.onclick=function(e){t&&t(),o(e)}}function o(e){var a=t.createElement("div");a.className="heart",s.push({el:a,x:e.clientX-5,y:e.clientY-5,scale:1,alpha:1,color:c()}),t.body.appendChild(a)}function i(e){var a=t.createElement("style");a.type="text/css";try{a.appendChild(t.createTextNode(e))}catch(t){a.styleSheet.cssText=e}t.getElementsByTagName("head")[0].appendChild(a)}function c(){return"rgb("+~~(255*Math.random())+","+~~(255*Math.random())+","+~~(255*Math.random())+")"}var s=[];e.requestAnimationFrame=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},i(".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}"),n(),r()}(window,document);
</script>
</body>
</html>
