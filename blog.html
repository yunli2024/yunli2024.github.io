<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>åšå®¢ â€” äº‘ç«‹</title>
  <meta name="description" content="äº‘ç«‹çš„åšå®¢">
  <style>
    :root{--bg1:#071026;--bg2:#061027;--surface:#071026;--text:#e6eef8;--muted:#94a3b8;--accent:#60a5fa;--card-border:rgba(255,255,255,0.03)}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial;margin:0;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:var(--text);transition:background-color .25s,color .25s}
    body.light{--bg1:#f5f7fb;--bg2:#fff;--surface:#fff;--text:#0b1220;--muted:#6b7280;--accent:#2563eb;--card-border:rgba(2,6,23,0.06)}
    .wrap{max-width:900px;margin:36px auto;padding:16px}
    a{color:var(--accent)}
    .post{padding:14px;border-bottom:1px solid var(--card-border)}
    .post h3{margin:0 0 6px}
    .controls{display:flex;gap:8px;justify-content:flex-end;margin-bottom:12px}
    .btn{background:var(--surface);padding:8px 12px;border-radius:8px;color:var(--text);text-decoration:none;border:1px solid var(--card-border)}
    .theme-toggle{position:fixed;right:14px;top:14px;background:var(--surface);color:var(--text);border:1px solid var(--card-border);padding:8px;border-radius:8px;cursor:pointer}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
  <div class="wrap">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px">
      <h1>åšå®¢</h1>
      <div class="controls"><a class="btn" href="editor.html">å†™æ–‡ç« </a></div>
    </div>

    <div id="list">åŠ è½½ä¸­â€¦</div>
  </div>

  <script>
    async function tryFetch(url){
      try{
        const res = await fetch(url);
        if(!res.ok) throw res;
        return await res.json();
      }catch(e){
        console.error('fetch failed for', url, e);
        throw e;
      }
    }

    async function loadIndex(){
      const list = document.getElementById('list');
      const candidates = [
        'posts/index.json',
        '/posts/index.json',
        location.origin + '/posts/index.json'
      ];
      let idx = null;
      for(const url of candidates){
        try{ idx = await tryFetch(url); break }catch(e){}
      }
      if(!idx){
        list.innerHTML = '<p>è¯»å–æ–‡ç« ç´¢å¼•å¤±è´¥ï¼ˆè¯·æ£€æŸ¥ posts/index.json æ˜¯å¦å­˜åœ¨å¹¶å¯é€šè¿‡ç½‘ç»œè®¿é—®ï¼›æ‰“å¼€æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†é”™è¯¯ï¼‰ã€‚</p>';
        return;
      }
      if(!Array.isArray(idx) || idx.length===0){list.innerHTML='<p>æš‚æ— æ–‡ç« ã€‚</p>';return}
      list.innerHTML='';
      idx.forEach(item=>{
        const el = document.createElement('div'); el.className='post';
        el.innerHTML=`<h3><a href="post.html?file=${encodeURIComponent(item.file)}">${item.title}</a></h3><div style="color:#94a3b8">${item.date} Â· ${item.tags||''}</div><p>${item.excerpt||''}</p>`;
        list.appendChild(el);
      })
    }
    loadIndex();
  </script>
  <button id="globalThemeBtn" class="theme-toggle" title="åˆ‡æ¢æ—¥/å¤œæ¨¡å¼">ğŸŒ™</button>
  <script>
    // Theme persistence and toggle for this page
    const gBtn = document.getElementById('globalThemeBtn');
    function applyThemePage(t){ if(t==='light') document.body.classList.add('light'); else document.body.classList.remove('light'); gBtn.textContent = document.body.classList.contains('light') ? 'â˜€ï¸' : 'ğŸŒ™'; try{localStorage.setItem('site-theme', t)}catch(e){} }
    (function(){ let t='dark'; try{const s=localStorage.getItem('site-theme'); if(s) t=s;}catch(e){} applyThemePage(t); gBtn.addEventListener('click', ()=>{const cur=document.body.classList.contains('light')?'light':'dark'; applyThemePage(cur==='light'?'dark':'light');}); })();
  </script>
</body>
</html>
